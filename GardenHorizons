local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "SCJ Horizons V2.1",
   LoadingTitle = "Đang kiểm tra mục tiêu...",
   LoadingSubtitle = "by Gemini",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "SCJ_Horizons_Configs", 
      FileName = "MainConfig"
   },
   KeySystem = false, 
})

-- Tab 1: Thông tin
local Tab1 = Window:CreateTab("Thông tin", 4483362458)
Tab1:CreateSection("Cấu hình lọc mục tiêu")
Tab1:CreateLabel("Trạng thái: Đang lọc Cabbage")
Tab1:CreateParagraph({Title = "Quy tắc nhấn E", Content = "Dòng chữ phải có 'Harvest' và tuyệt đối KHÔNG có 'Cabbage' mới tự động nhấn."})

-- Tab 2: Chức năng
local Tab2 = Window:CreateTab("Chức năng", 4483362458)

local _G = { MainEnabled = false }
local VirtualInputManager = game:GetService("VirtualInputManager")
local Player = game:GetService("Players").LocalPlayer

-- Hàm quét và điều chỉnh Range
local function UpdateHarvestRange(enable)
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("ProximityPrompt") then
            -- Nếu có chữ Harvest nhưng KHÔNG có chữ Cabbage thì mới buff range
            local text = (v.ObjectText .. v.ActionText):lower()
            if text:find("harvest") and not text:find("cabbage") then
                v.MaxActivationDistance = enable and 100 or 5
            end
        end
    end
end

Tab2:CreateSection("Farm thông minh (Lọc Bắp Cải)")

Tab2:CreateToggle({
   Name = "Auto Harvest (Bỏ qua Cabbage)",
   CurrentValue = false,
   Flag = "MainToggle_Config", 
   Callback = function(Value)
      _G.MainEnabled = Value
      
      if Value then
          Player.CameraMaxZoomDistance = 10000 
          UpdateHarvestRange(true)
          
          Rayfield:Notify({
             Title = "Đã kích hoạt",
             Content = "Đang farm mọi thứ trừ Cabbage!",
             Duration = 2,
             Image = 4483362458,
          })
          
          task.spawn(function()
              while _G.MainEnabled do
                  local targetFound = false
                  
                  for _, prompt in pairs(workspace:GetDescendants()) do
                      if prompt:IsA("ProximityPrompt") then
                          local objText = prompt.ObjectText:lower()
                          local actText = prompt.ActionText:lower()
                          
                          -- ĐIỀU KIỆN: Có 'harvest' VÀ KHÔNG có 'cabbage'
                          if (objText:find("harvest") or actText:find("harvest")) and 
                             not (objText:find("cabbage") or actText:find("cabbage")) then
                              
                              if prompt.Enabled and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
                                  local dist = (Player.Character.HumanoidRootPart.Position - prompt.Parent:GetModelCFrame().Position).Magnitude
                                  if dist <= 100 then
                                      targetFound = true
                                      break
                                  end
                              end
                          end
                      end
                  end

                  if targetFound then
                      VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                      task.wait(0.05)
                      VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                  end
                  
                  task.wait(0.1)
              end
          end)
      else
          Player.CameraMaxZoomDistance = 20
          UpdateHarvestRange(false)
          
          Rayfield:Notify({
             Title = "Đã tắt",
             Content = "Đã ngừng farm.",
             Duration = 2,
             Image = 4483362458,
          })
      end
   end,
})

Rayfield:LoadConfiguration()
