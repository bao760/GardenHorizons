local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Garden Horizons",
   LoadingTitle = "ƒêang t·∫£i Script...",
   LoadingSubtitle = "by CC",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "SupportGameConfig", 
      FileName = "MainConfig"
   }
})

-- ==========================================
-- BI·∫æN TO√ÄN C·ª§C
-- ==========================================
local sellPos = Vector3.new(148.26, 204.03, 673.12)
local customStuds = 12
local sellInterval = 60
local autoReturnUI = false

-- ==========================================
-- H√ÄM H·ªñ TR·ª¢ CLICK (ƒê√É FIX T·ªåA ƒê·ªò M·ªöI)
-- ==========================================

local function clickGardenUI()
    local success, result = pcall(function()
        local vim = game:GetService("VirtualInputManager")
        local camera = workspace.CurrentCamera
        local screenSize = camera.ViewportSize
        
        -- T·ªça ƒë·ªô b·∫°n ƒë∆∞a: {0.164417729, 0}, {0.982799768, 0}
        -- X: 16.4% m√†n h√¨nh | Y: 98.2% m√†n h√¨nh (G·∫ßn s√°t m√©p d∆∞·ªõi)
        local targetX = screenSize.X * 0.164417729
        local targetY = screenSize.Y * 0.982799768
        
        -- Gi·∫£ l·∫≠p click chu·ªôt tr√°i
        vim:SendMouseButtonEvent(targetX, targetY, 0, true, game, 1)
        task.wait(0.1)
        vim:SendMouseButtonEvent(targetX, targetY, 0, false, game, 1)
        
        return true
    end)
    
    if not success then
        -- Fallback method n·∫øu c√°ch tr√™n kh√¥ng ho·∫°t ƒë·ªông
        pcall(function()
            local player = game.Players.LocalPlayer
            local gardenButton = player:FindFirstChild("PlayerGui") 
                and player.PlayerGui:FindFirstChild("Hud_UI") 
                and player.PlayerGui.Hud_UI:FindFirstChild("TopButtons") 
                and player.PlayerGui.Hud_UI.TopButtons:FindFirstChild("YourGarden")
            
            if gardenButton then
                for _, connection in pairs(getconnections(gardenButton.MouseButton1Click)) do
                    connection:Fire()
                end
            end
        end)
    end
end

-- H√†m th·ª±c hi·ªán h√†nh ƒë·ªông Sell
local function performSell()
    local player = game.Players.LocalPlayer
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local hrp = character.HumanoidRootPart
        local currentPos = hrp.CFrame -- L∆∞u v·ªã tr√≠ hi·ªán t·∫°i

        -- 1. Teleport ƒëi b√°n
        hrp.CFrame = CFrame.new(sellPos)
        task.wait(0.7)
        
        -- 2. G·ª≠i l·ªánh Sell
        local args = {"SellAll"}
        local sellSuccess = pcall(function()
            game:GetService("ReplicatedStorage"):WaitForChild("RemoteEvents"):WaitForChild("SellItems"):InvokeServer(unpack(args))
        end)
        
        if sellSuccess then
            Rayfield:Notify({Title = "System", Content = "Sold! Waiting 3s...", Duration = 2})
        else
            Rayfield:Notify({Title = "System", Content = "Sell failed!", Duration = 2})
        end
        
        -- 3. ƒê·ª£i 3 gi√¢y
        task.wait(3) 
        
        -- 4. Click Garden UI ƒë·ªÉ quay v·ªÅ
        if autoReturnUI then
            clickGardenUI()
            Rayfield:Notify({Title = "System", Content = "Clicked Garden UI!", Duration = 2})
        end
        
        -- Teleport v·ªÅ v·ªã tr√≠ c≈© (t√πy ch·ªçn)
        -- hrp.CFrame = currentPos
    end
end

-- ==========================================
-- V√íNG L·∫∂P AUTO E (T·ªêI ∆ØU H∆†N - 0.05S)
-- ==========================================
local autoE = false
local eLoopRunning = false

local function startELoop()
    if eLoopRunning then return end
    eLoopRunning = true
    
    task.spawn(function()
        local vim = game:GetService("VirtualInputManager")
        local player = game.Players.LocalPlayer
        
        while autoE do
            -- Ki·ªÉm tra xem c√≥ prompt n√†o trong t·∫ßm kh√¥ng
            local char = player.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")
            
            if hrp then
                -- T√¨m prompt g·∫ßn nh·∫•t
                for _, obj in pairs(game:GetDescendants()) do
                    if obj:IsA("ProximityPrompt") and obj.Enabled and obj.ActionText == "Harvest" then
                        local dist = (hrp.Position - obj.Parent.Position).Magnitude
                        if dist <= obj.MaxActivationDistance then
                            -- Quay m·∫∑t v·ªÅ ph√≠a prompt
                            hrp.CFrame = CFrame.lookAt(hrp.Position, obj.Parent.Position)
                            break
                        end
                    end
                end
            end
            
            -- Nh·∫•n E v·ªõi t·ªëc ƒë·ªô 0.05s
            vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
            task.wait(0.02)
            vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
            
            task.wait(0.05) -- T·ªëc ƒë·ªô 0.05s ch√≠nh x√°c
        end
        
        eLoopRunning = false
    end)
end

-- ==========================================
-- V√íNG L·∫∂P BUFF RANGE (T·ªêI ∆ØU H∆†N)
-- ==========================================
local buffRangeEnabled = false
local rangeLoopRunning = false

local function startRangeLoop()
    if rangeLoopRunning then return end
    rangeLoopRunning = true
    
    task.spawn(function()
        while buffRangeEnabled do
            for _, obj in pairs(game:GetDescendants()) do
                if obj:IsA("ProximityPrompt") and obj.ActionText == "Harvest" then
                    obj.MaxActivationDistance = customStuds
                    -- T·∫Øt Hold n·∫øu c√≥
                    if obj.HoldDuration > 0 then
                        obj.HoldDuration = 0
                    end
                end
            end
            task.wait(2) -- Gi·∫£m t·∫ßn su·∫•t qu√©t ƒë·ªÉ ƒë·ª° lag
        end
        rangeLoopRunning = false
    end)
end

-- ==========================================
-- TAB 1: INFO
-- ==========================================
local InfoTab = Window:CreateTab("Info", 4483362458)
InfoTab:CreateSection("Script Info")
InfoTab:CreateLabel("Fix: Bottom-Left Coordinate Click")
InfoTab:CreateLabel("Auto E with Face Tracking (0.05s)")
InfoTab:CreateLabel("Buff Range + Instant Harvest")
InfoTab:CreateLabel("Support Tab - Fix Lag & T·ªëi ∆∞u FPS")

-- ==========================================
-- TAB 2: MAIN
-- ==========================================
local MainTab = Window:CreateTab("Main", 4483362458)
MainTab:CreateSection("Auto Controls")

MainTab:CreateToggle({
   Name = "Auto Press E (0.05s + Face Tracking)",
   CurrentValue = false,
   Flag = "ToggleE", 
   Callback = function(Value)
      autoE = Value
      if Value then
          startELoop()
          Rayfield:Notify({Title = "Auto E", Content = "ƒê√£ b·∫≠t - T·ªëc ƒë·ªô 0.05s + t·ª± ƒë·ªông quay m·∫∑t", Duration = 2})
      else
          Rayfield:Notify({Title = "Auto E", Content = "ƒê√£ t·∫Øt", Duration = 2})
      end
   end,
})

MainTab:CreateSection("Harvest Range")
local rangeInput = MainTab:CreateInput({
   Name = "Studs Amount",
   CurrentValue = "12",
   PlaceholderText = "Enter studs...",
   Flag = "InputStuds",
   Callback = function(Text)
      customStuds = tonumber(Text) or 12
      if buffRangeEnabled then
          Rayfield:Notify({Title = "Range", Content = "ƒê√£ c·∫≠p nh·∫≠t: " .. customStuds .. " studs", Duration = 1.5})
      end
   end,
})

MainTab:CreateToggle({
   Name = "Buff Range + Instant Harvest",
   CurrentValue = false,
   Flag = "ToggleHarvest", 
   Callback = function(Value)
      buffRangeEnabled = Value
      if Value then
          startRangeLoop()
          Rayfield:Notify({Title = "Buff Range", Content = "ƒê√£ b·∫≠t (Range: " .. customStuds .. " studs)", Duration = 2})
      else
          Rayfield:Notify({Title = "Buff Range", Content = "ƒê√£ t·∫Øt", Duration = 2})
      end
   end,
})

-- ==========================================
-- TAB 3: FARM
-- ==========================================
local FarmTab = Window:CreateTab("Farm", 4483362458)

local ReturnSection = FarmTab:CreateSection("Return Settings")
FarmTab:CreateToggle({ 
   Name = "Auto Click Garden UI (3s Delay)",
   CurrentValue = false,
   Flag = "ToggleReturnUI", 
   Callback = function(Value)
      autoReturnUI = Value
   end,
})

-- N√∫t Test Click ƒë·ªÉ b·∫°n ki·ªÉm tra t·ªça ƒë·ªô ngay l·∫≠p t·ª©c
FarmTab:CreateButton({
   Name = "Test Click Garden UI",
   Callback = function()
      clickGardenUI()
      Rayfield:Notify({Title = "Test", Content = "ƒê√£ click Garden UI", Duration = 2})
   end,
})

-- N√∫t Test Sell
FarmTab:CreateButton({
   Name = "Test Sell Now",
   Callback = function()
      performSell()
   end,
})

local SellSection = FarmTab:CreateSection("Auto Sell Settings")
FarmTab:CreateInput({
   Name = "Sell Interval (Seconds)",
   CurrentValue = "60",
   PlaceholderText = "Enter seconds...",
   Flag = "InputInterval",
   Callback = function(Text)
      sellInterval = tonumber(Text) or 60
   end,
})

local autoSellTime = false
FarmTab:CreateToggle({
   Name = "Enable Sell Time",
   CurrentValue = false,
   Flag = "ToggleSellTime", 
   Callback = function(Value)
      autoSellTime = Value
      task.spawn(function()
         while autoSellTime do
            task.wait(sellInterval)
            if autoSellTime then performSell() end
         end
      end)
   end,
})

local sellIfFull = false
FarmTab:CreateToggle({
   Name = "Sell If Full (290 items)",
   CurrentValue = false,
   Flag = "ToggleFull", 
   Callback = function(Value)
      sellIfFull = Value
      task.spawn(function()
         while sellIfFull do
            local player = game.Players.LocalPlayer
            local itemCount = #player.Backpack:GetChildren()
            if player.Character and player.Character:FindFirstChildOfClass("Tool") then 
                itemCount = itemCount + 1 
            end
            if itemCount >= 290 then
                performSell()
                task.wait(5)
            end
            task.wait(2)
         end
      end)
   end,
})

-- Th√™m n√∫t Teleport v·ªÅ ƒëi·ªÉm b√°n
FarmTab:CreateButton({
   Name = "Teleport to Sell Point",
   Callback = function()
      local player = game.Players.LocalPlayer
      local character = player.Character
      if character and character:FindFirstChild("HumanoidRootPart") then
         character.HumanoidRootPart.CFrame = CFrame.new(sellPos)
         Rayfield:Notify({Title = "Teleport", Content = "ƒê√£ teleport ƒë·∫øn ƒëi·ªÉm b√°n", Duration = 2})
      end
   end,
})

-- ==========================================
-- TAB 4: SUPPORT (FIX LAG & T·ªêI ∆ØU)
-- ==========================================
local SupportTab = Window:CreateTab("Support", 4483362458)

SupportTab:CreateSection("T·ªëi ∆Øu H√≥a & Fix Lag")

-- Bi·∫øn theo d√µi tr·∫°ng th√°i
local lowGraphicsEnabled = false
local removePartsEnabled = false
local fpsBoostEnabled = false

-- H√†m gi·∫£m graphics xu·ªëng m·ª©c th·∫•p nh·∫•t
local function enableLowGraphics()
    pcall(function()
        -- Gi·∫£m ch·∫•t l∆∞·ª£ng ƒë·ªì h·ªça
        local setting = settings()
        setting.Rendering.QualityLevel = 1
        
        -- T·∫Øt c√°c hi·ªáu ·ª©ng kh√¥ng c·∫ßn thi·∫øt
        game:GetService("Lighting").GlobalShadows = false
        game:GetService("Lighting").FogEnd = 100000
        game:GetService("Lighting").Brightness = 2
        
        -- T·∫Øt c√°c hi·ªáu ·ª©ng n∆∞·ªõc
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("Terrain") then
                obj.WaterWaveSize = 0
                obj.WaterWaveSpeed = 0
                obj.WaterReflectance = 0
                obj.WaterTransparency = 1
            end
        end
        
        Rayfield:Notify({Title = "Graphics", Content = "ƒê√£ gi·∫£m ch·∫•t l∆∞·ª£ng ƒë·ªì h·ªça", Duration = 2})
    end)
end

-- H√†m x√≥a c√°c part kh√¥ng c·∫ßn thi·∫øt
local function removeLaggyParts()
    pcall(function()
        local removedCount = 0
        
        -- X√≥a c√°c particle emitter v√† c√°c hi·ªáu ·ª©ng
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") or obj:IsA("Sparkles") then
                obj.Enabled = false
                removedCount = removedCount + 1
            end
            
            -- Gi·∫£m detail c·ªßa mesh
            if obj:IsA("SpecialMesh") then
                obj.TextureId = ""
            end
            
            -- X√≥a c√°c decal kh√¥ng c·∫ßn thi·∫øt
            if obj:IsA("Decal") then
                obj.Transparency = 1
            end
        end
        
        Rayfield:Notify({Title = "Remove Effects", Content = "ƒê√£ t·∫Øt " .. removedCount .. " hi·ªáu ·ª©ng", Duration = 2})
    end)
end

-- H√†m t·ªëi ∆∞u to√†n di·ªán
local function boostFPS()
    pcall(function()
        -- T·∫Øt √¢m thanh
        for _, obj in pairs(game:GetDescendants()) do
            if obj:IsA("Sound") then
                obj.Volume = 0
                obj.Playing = false
            end
        end
        
        -- Gi·∫£m draw distance
        local camera = workspace.CurrentCamera
        if camera then
            camera.MaxAxis = 500
        end
        
        -- X√≥a c√°c ph·∫ßn t·ª≠ GUI kh√¥ng c·∫ßn thi·∫øt
        local player = game.Players.LocalPlayer
        if player and player.PlayerGui then
            for _, gui in pairs(player.PlayerGui:GetChildren()) do
                if gui:IsA("ScreenGui") and gui.Name ~= "Hud_UI" then
                    gui.Enabled = false
                end
            end
        end
        
        -- T·ªëi ∆∞u h√≥a workspace
        workspace.DescendantAdded:Connect(function(descendant)
            if fpsBoostEnabled then
                if descendant:IsA("ParticleEmitter") or descendant:IsA("Trail") then
                    descendant.Enabled = false
                end
            end
        end)
        
        Rayfield:Notify({Title = "FPS Boost", Content = "ƒê√£ t·ªëi ∆∞u FPS, kh·ªüi ƒë·ªông l·∫°i n·∫øu c·∫ßn", Duration = 3})
    end)
end

-- C√°c n√∫t ch·ª©c nƒÉng trong Support Tab
SupportTab:CreateButton({
   Name = "üîß Gi·∫£m Graphics (Low Quality)",
   Callback = function()
      enableLowGraphics()
   end,
})

SupportTab:CreateButton({
   Name = "üßπ D·ªçn D·∫πp Hi·ªáu ·ª®ng (Remove Particles)",
   Callback = function()
      removeLaggyParts()
   end,
})

SupportTab:CreateButton({
   Name = "‚ö° Boost FPS (T·ªëi ∆∞u to√†n di·ªán)",
   Callback = function()
      fpsBoostEnabled = true
      boostFPS()
   end,
})

SupportTab:CreateSection("T·ªëi ∆Øu Part & Mesh")

-- N√∫t chuy·ªÉn ƒë·ªïi part l·ªõn th√†nh part nh·ªè
SupportTab:CreateButton({
   Name = "üîÑ Chuy·ªÉn Part L·ªõn ‚Üí Part Nh·ªè",
   Callback = function()
      pcall(function()
          local converted = 0
          for _, obj in pairs(workspace:GetDescendants()) do
              if obj:IsA("Part") or obj:IsA("MeshPart") then
                  local size = obj.Size
                  if size.X > 10 or size.Y > 10 or size.Z > 10 then
                      -- Chia nh·ªè part l·ªõn (gi·∫£ l·∫≠p b·∫±ng c√°ch gi·∫£m size v√† transparency)
                      obj.Transparency = 0.5
                      obj.Material = Enum.Material.SmoothPlastic
                      converted = converted + 1
                  end
              end
          end
          Rayfield:Notify({Title = "Convert Parts", Content = "ƒê√£ x·ª≠ l√Ω " .. converted .. " part l·ªõn", Duration = 2})
      end)
   end,
})

-- N√∫t x√≥a mesh ph·ª©c t·∫°p
SupportTab:CreateButton({
   Name = "üóëÔ∏è X√≥a Mesh Ph·ª©c T·∫°p",
   Callback = function()
      pcall(function()
          local removed = 0
          for _, obj in pairs(workspace:GetDescendants()) do
              if obj:IsA("MeshPart") and obj.MeshId ~= "" then
                  obj.Transparency = 1
                  removed = removed + 1
              end
          end
          Rayfield:Notify({Title = "Remove Mesh", Content = "ƒê√£ ·∫©n " .. removed .. " mesh ph·ª©c t·∫°p", Duration = 2})
      end)
   end,
})

SupportTab:CreateSection("Network T·ªëi ∆Øu")

-- N√∫t gi·∫£m streaming
SupportTab:CreateButton({
   Name = "üì° T·ªëi ∆Øu Network",
   Callback = function()
      pcall(function()
          local player = game.Players.LocalPlayer
          if player then
              -- Gi·∫£m t·∫£i network
              settings().Network.IncomingReplicationLag = 0
              
              -- T·ªëi ∆∞u h√≥a streaming
              player.ReplicationFocus = workspace.CurrentCamera
              
              -- Gi·ªõi h·∫°n hi·ªÉn th·ªã
              workspace.StreamingEnabled = true
              workspace.StreamingMinRadius = 100
              workspace.StreamingTargetRadius = 200
          end
          Rayfield:Notify({Title = "Network", Content = "ƒê√£ t·ªëi ∆∞u streaming", Duration = 2})
      end)
   end,
})

SupportTab:CreateSection("Reset & Kh√¥i Ph·ª•c")

-- N√∫t reset m·ªçi th·ª©
SupportTab:CreateButton({
   Name = "üîÑ Reset T·∫•t C·∫£",
   Callback = function()
      pcall(function()
          -- B·∫≠t l·∫°i c√°c hi·ªáu ·ª©ng
          for _, obj in pairs(workspace:GetDescendants()) do
              if obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
                  obj.Enabled = true
              end
          end
          
          -- B·∫≠t l·∫°i ƒë·ªì h·ªça
          local setting = settings()
          setting.Rendering.QualityLevel = 21
          
          game:GetService("Lighting").GlobalShadows = true
          
          -- B·∫≠t l·∫°i sound
          for _, obj in pairs(game:GetDescendants()) do
              if obj:IsA("Sound") then
                  obj.Volume = 0.5
              end
          end
          
          fpsBoostEnabled = false
          Rayfield:Notify({Title = "Reset", Content = "ƒê√£ reset t·∫•t c·∫£ c√†i ƒë·∫∑t", Duration = 2})
      end)
   end,
})

-- N√∫t ki·ªÉm tra FPS
SupportTab:CreateButton({
   Name = "üìä Ki·ªÉm Tra FPS",
   Callback = function()
      local startTime = tick()
      local frameCount = 0
      
      local connection = game:GetService("RunService").RenderStepped:Connect(function()
          frameCount = frameCount + 1
      end)
      
      task.wait(1)
      connection:Disconnect()
      
      local fps = math.floor(frameCount / (tick() - startTime))
      Rayfield:Notify({Title = "FPS Counter", Content = "FPS hi·ªán t·∫°i: " .. fps, Duration = 3})
   end,
})

-- ==========================================
-- LOAD CONFIG
-- ==========================================
Rayfield:LoadConfiguration()

-- Load c·∫•u h√¨nh sau khi kh·ªüi t·∫°o
task.spawn(function()
    task.wait(1.5)
    if Rayfield.Flags["InputStuds"] then 
        customStuds = tonumber(Rayfield.Flags["InputStuds"].CurrentValue) or 12 
    end
    if Rayfield.Flags["InputInterval"] then 
        sellInterval = tonumber(Rayfield.Flags["InputInterval"].CurrentValue) or 60 
    end
end)
