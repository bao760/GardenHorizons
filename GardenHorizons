-- Sử dụng link thư viện chính thức và ổn định nhất
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()

local Window = Rayfield:CreateWindow({
   Name = "SCJ Horizons",
   LoadingTitle = "Đang khởi tạo hệ thống...",
   LoadingSubtitle = "by Gemini",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "SCJ_Horizons_Configs", 
      FileName = "MainConfig"
   },
   KeySystem = false, 
})

-- Tab 1: Thông tin
local Tab1 = Window:CreateTab("Thông tin", 4483362458)
Tab1:CreateSection("Cấu hình lọc mục tiêu")
Tab1:CreateLabel("Script: Đã sửa lỗi Load")
Tab1:CreateLabel("Mục tiêu: Harvest (Bỏ qua Cabbage)")

-- Tab 2: Chức năng
local Tab2 = Window:CreateTab("Chức năng", 4483362458)

local _G = { MainEnabled = false }
local VirtualInputManager = game:GetService("VirtualInputManager")
local Player = game:GetService("Players").LocalPlayer

-- Hàm quét và điều chỉnh Range
local function UpdateHarvestRange(enable)
    pcall(function() -- Sử dụng pcall để tránh lỗi vặt khi quét vật thể
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("ProximityPrompt") then
                local objText = v.ObjectText:lower()
                local actText = v.ActionText:lower()
                local fullText = objText .. actText
                
                if fullText:find("harvest") and not fullText:find("cabbage") then
                    v.MaxActivationDistance = enable and 100 or 5
                end
            end
        end
    end)
end

Tab2:CreateSection("Farm thông minh (Range 100)")

Tab2:CreateToggle({
   Name = "Auto Harvest (Lọc Bắp Cải)",
   CurrentValue = false,
   Flag = "MainToggle_Config", 
   Callback = function(Value)
      _G.MainEnabled = Value
      
      if Value then
          if Player then Player.CameraMaxZoomDistance = 10000 end
          UpdateHarvestRange(true)
          
          task.spawn(function()
              while _G.MainEnabled do
                  local targetFound = false
                  
                  -- Tìm mục tiêu thỏa mãn điều kiện
                  for _, prompt in pairs(workspace:GetDescendants()) do
                      if prompt:IsA("ProximityPrompt") then
                          local fullText = (prompt.ObjectText .. prompt.ActionText):lower()
                          
                          if fullText:find("harvest") and not fullText:find("cabbage") then
                              if prompt.Enabled and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
                                  local dist = (Player.Character.HumanoidRootPart.Position - prompt.Parent:GetModelCFrame().Position).Magnitude
                                  if dist <= 100 then
                                      targetFound = true
                                      break
                                  end
                              end
                          end
                      end
                  end

                  if targetFound then
                      VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                      task.wait(0.05)
                      VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                  end
                  
                  task.wait(0.1)
              end
          end)
      else
          if Player then Player.CameraMaxZoomDistance = 20 end
          UpdateHarvestRange(false)
      end
   end,
})

-- Tự động tải cấu hình
Rayfield:LoadConfiguration()
